#!/usr/bin/env python3

import asyncio
import multiprocessing

from autobahn.asyncio import wamp

from config.settings import Config
from apollo.command_receiver_component import CommandReceiverComponent


def start_command_receiver(command_queue, url, realm, loop=None):
    # New event loops are required for event loops to run in a subprocess
    runner = wamp.ApplicationRunner(
        url,
        realm=realm,
        extra={'command_queue': command_queue}
    )
    runner.run(CommandReceiverComponent)


command_queue = asyncio.Queue(Config.COMMAND_QUEUE_SIZE)

start_command_receiver(
    command_queue,
    Config.ROUTER_URL,
    Config.ROUTER_REALM
)
